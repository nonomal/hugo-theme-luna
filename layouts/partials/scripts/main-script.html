{{- $public_cdn := cond .Site.IsServer "" .Site.Params.publicCDN -}}
{{- $searchScript := resources.Get "ts/search.ts" | js.Build (dict "minify" hugo.IsProduction) -}}

{{- $katex := "" -}}
{{- if .Site.Params.katex -}}
    {{- $katex = print $public_cdn (resources.Get "ts/katex.ts" | js.Build (dict "minify" hugo.IsProduction "shims" (dict "katex" "modules/katex/katex.js"))).RelPermalink -}}
{{- end -}}
{{- $mainScript := resources.Get "ts/main.ts" | js.Build (dict "minify" hugo.IsProduction "params" (dict "search" $searchScript.RelPermalink "katex" $katex)) -}}
{{- if .Site.IsServer -}}
    <script type="text/javascript" src="{{- $mainScript.RelPermalink -}}" defer></script>
{{- else -}}
    {{- $mainScript := $mainScript | fingerprint -}}    <script type="text/javascript" src="{{- print $public_cdn $mainScript.RelPermalink -}}" defer integrity="{{- $mainScript.Data.Integrity -}}"></script>
{{- end -}}
